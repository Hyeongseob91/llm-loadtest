# 메트릭 상세 설명

> LLM Loadtest에서 측정하는 모든 메트릭에 대한 상세 설명

## 지연 시간 메트릭 (Latency Metrics)

### TTFT (Time To First Token)

첫 토큰 응답 시간 - 사용자가 응답 시작을 인지하는 시간

| 항목 | 내용 |
|------|------|
| **정의** | 요청 전송 후 첫 토큰 수신까지의 시간 |
| **단위** | 밀리초 (ms) |
| **계산** | `first_token_time - request_start_time` |
| **의미** | 인터랙티브성, 사용자 대기 시간 |
| **목표** | 낮을수록 좋음 (일반적 SLO: <500ms) |
| **영향 요인** | 프롬프트 길이, 모델 크기, 서버 큐 대기 시간 |

### TPOT (Time Per Output Token)

토큰 생성 속도 - 디코딩 성능 지표

| 항목 | 내용 |
|------|------|
| **정의** | 첫 토큰 이후 각 토큰 생성에 소요되는 평균 시간 |
| **단위** | 밀리초 (ms) |
| **계산** | `(end_time - first_token_time) / (output_tokens - 1)` |
| **의미** | 토큰 생성 처리량의 역수 |
| **목표** | 낮을수록 좋음 (SLO: <50ms) |
| **역관계** | TPOT 50ms = 초당 ~20토큰 생성 |

### ITL (Inter-Token Latency)

토큰 간 지연 시간 - 생성 일관성 지표

| 항목 | 내용 |
|------|------|
| **정의** | 연속 토큰 간 시간 간격 |
| **단위** | 밀리초 (ms) 배열 |
| **의미** | 토큰 생성의 일관성 |
| **해석** | ITL 편차 작음 → 안정적, 편차 큼 → 불안정 |

### E2E Latency (End-to-End)

전체 응답 시간 - 사용자가 체감하는 총 대기 시간

| 항목 | 내용 |
|------|------|
| **정의** | 요청 전송부터 완전한 응답까지 총 시간 |
| **단위** | 밀리초 (ms) |
| **공식** | `E2E = TTFT + TPOT × (output_tokens - 1)` |
| **의미** | 전체 사용자 대기 시간 |

---

## 처리량 메트릭 (Throughput Metrics)

### Throughput

| 항목 | 내용 |
|------|------|
| **정의** | 초당 생성되는 토큰 수 |
| **단위** | tokens/second |
| **계산** | `total_output_tokens / duration_seconds` |
| **목표** | 높을수록 좋음 |

### Request Rate

| 항목 | 내용 |
|------|------|
| **정의** | 초당 처리되는 요청 수 |
| **단위** | requests/second |
| **의미** | 시스템의 동시 처리 능력 |

---

## 백분위수 (Percentiles)

모든 지연 메트릭은 다음 통계를 제공합니다:

| 백분위수 | 의미 | 용도 |
|----------|------|------|
| **min/max** | 최솟값/최댓값 | 극단값 확인 |
| **mean** | 평균값 | 전체 경향 |
| **p50 (median)** | 50% 요청이 이 값 이하 | 일반적 성능 |
| **p95** | 95% 요청이 이 값 이하 | 높은 지연 감지 |
| **p99** | 99% 요청이 이 값 이하 | 극단 케이스 |
| **std** | 표준편차 | 변동성 |

**예시**: TTFT p95 = 2000ms → 95%의 요청이 2초 이내에 첫 토큰 수신

---

## Goodput (품질 기반 처리량)

**NVIDIA GenAI-Perf에서 제안한 개념**으로, 단순 처리량이 아닌 **SLO를 만족하는 요청의 비율**을 측정합니다.

### SLO 임계값 설정

```bash
--goodput ttft:500,tpot:50,e2e:5000
# TTFT < 500ms AND TPOT < 50ms AND E2E < 5000ms
```

### 계산 로직

**AND 조건**: 모든 활성 임계값을 동시에 만족해야 함

```
satisfied = (ttft < ttft_threshold) AND (tpot < tpot_threshold) AND (e2e < e2e_threshold)
goodput = satisfied_requests / total_requests × 100%
```

### 결과 예시

```
Goodput: 87.0% (87/100 requests met SLO)
  - TTFT < 500ms: 92/100 (92%)
  - TPOT < 50ms: 89/100 (89%)
  - Both (AND): 87/100 (87%)  ← Final Goodput
```

### 왜 Goodput이 중요한가?

| 시나리오 | Throughput | Goodput | 해석 |
|----------|------------|---------|------|
| A | 500 tok/s | 95% | 높은 처리량, 높은 품질 - **최적** |
| B | 800 tok/s | 60% | 높은 처리량, 낮은 품질 - **문제 있음** |
| C | 400 tok/s | 99% | 중간 처리량, 높은 품질 - **안정적** |

**결론**: 처리량이 높아도 품질이 낮으면 실제 서비스에서는 의미가 없습니다.
